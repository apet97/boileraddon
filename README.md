# Clockify Add-on Boilerplate

A clean, self-contained starting point for building Clockify add-ons with **zero external SDK dependencies**. Everything ships as Maven modules that resolve only public Maven Central artifacts.

## Requirements

| Tool | Version | Notes |
| --- | --- | --- |
| Java | 17 or newer | Verify with `java -version`. |
| Maven | 3.6 or newer | Verify with `mvn -version`. |
| ngrok | Latest | Optional; required only when exposing localhost to Clockify. |

## Quickstart

1. **Clone and enter the repo**
   ```bash
   git clone https://github.com/apet97/boileraddon.git
   cd boileraddon
   ```
2. **Build every module (downloads Maven Central dependencies on first run)**
   ```bash
   mvn clean package -DskipTests
   ```
3. **Run the Auto-Tag Assistant example**
   ```bash
   ADDON_PORT=8080 ADDON_BASE_URL=http://localhost:8080/auto-tag-assistant \
   java -jar addons/auto-tag-assistant/target/auto-tag-assistant-0.1.0-jar-with-dependencies.jar
   ```
4. **Expose the server to Clockify (second terminal)**
   ```bash
   ngrok http 8080
   ```
5. **Install in Clockify** – Copy the HTTPS URL from ngrok and provide `https://<your-domain>/auto-tag-assistant/manifest.json` when installing a custom add-on in **Admin → Add-ons**.

The runtime manifest served at `/auto-tag-assistant/manifest.json` is already schema-compliant and omits `$schema`, so Clockify accepts it without modification.

## Auto-Tag Assistant Walkthrough

The sample add-on demonstrates the complete lifecycle:

1. `AutoTagAssistantApp` builds a manifest, registers endpoints, and launches Jetty with the inline SDK.【F:addons/auto-tag-assistant/src/main/java/com/example/autotagassistant/AutoTagAssistantApp.java†L23-L96】
2. `LifecycleHandlers` captures the workspace token and environment claims from the INSTALLED payload and stores them via `TokenStore`.【F:addons/auto-tag-assistant/src/main/java/com/example/autotagassistant/LifecycleHandlers.java†L23-L93】【F:addons/auto-tag-assistant/src/main/java/com/example/autotagassistant/TokenStore.java†L19-L89】
3. `WebhookHandlers` processes time-entry events, and `ClockifyApiClient` shows how to call back into Clockify using the stored credentials.
4. The inline SDK (`sdk/` package) handles manifest modeling, request routing, and lifecycle/webhook dispatch without any external dependencies.【F:addons/auto-tag-assistant/src/main/java/com/example/autotagassistant/sdk/ClockifyAddon.java†L9-L95】【F:addons/auto-tag-assistant/src/main/java/com/example/autotagassistant/sdk/AddonServlet.java†L15-L117】

Useful test commands while the server is running:

```bash
curl http://localhost:8080/auto-tag-assistant/health
curl http://localhost:8080/auto-tag-assistant/manifest.json
curl http://localhost:8080/auto-tag-assistant/settings
```

## Using the Template Module

Prefer to start from a blank slate? Use the Java template under `templates/java-basic-addon/`.

```bash
# Build only the template
mvn -f templates/java-basic-addon/pom.xml clean package -DskipTests

# Or via Makefile helper
make build-template

# Run the generated fat JAR
java -jar templates/java-basic-addon/target/java-basic-addon-0.1.0-jar-with-dependencies.jar
```

The template still benefits from the inline SDK. Follow the [Building Your Own Add-on guide](docs/BUILDING-YOUR-OWN-ADDON.md) to copy, rename, and customize it for your use case.

## Project Structure

```
boileraddon/
├── README.md
├── pom.xml
├── addons/
│   └── auto-tag-assistant/              # Full example add-on
│       ├── pom.xml
│       └── src/main/java/com/example/autotagassistant/
│           ├── *.java                   # Controllers, handlers, API client
│           └── sdk/                     # Minimal inline SDK
├── templates/
│   └── java-basic-addon/                # Minimal starter template
└── tools/
    └── validate-manifest.py             # Manifest validation helper
```

## Documentation

* [Architecture Overview](docs/ARCHITECTURE.md) – SDK modules, routing, claim handling, and endpoint registration flow.
* [Building Your Own Add-on](docs/BUILDING-YOUR-OWN-ADDON.md) – Copy/rename checklist, manifest customization, token storage, and deployment guidance.

## Troubleshooting

* **Manifest rejected by Clockify** – Ensure you are serving the runtime manifest generated by `ClockifyManifest`; it must omit `$schema` and unknown fields.
* **No webhook traffic** – Verify ngrok is forwarding the same port you used when starting the add-on and reinstall the manifest if the URL changes.
* **Missing tokens** – Check server logs for the `INSTALLED` lifecycle event; confirm `LifecycleHandlers` stored the token for your workspace.
