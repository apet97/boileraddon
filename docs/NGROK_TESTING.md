# Testing Add-ons with ngrok

Use ngrok to expose your local add-on over HTTPS so Clockify can fetch the manifest and call endpoints.

## Prerequisites
- Java 17 and Maven installed
- ngrok installed (`brew install ngrok` or download from ngrok.com)

## 1) Start ngrok
```
ngrok http 8080
```
Copy the printed HTTPS forwarding URL (for example `https://abc123.ngrok-free.app`).

## 2) Run the add-on with ADDON_BASE_URL set

Pick one add-on and run it with the ngrok domain in `ADDON_BASE_URL`:

Auto-Tag Assistant
```
make build-auto-tag-assistant
ADDON_BASE_URL=https://abc123.ngrok-free.app/auto-tag-assistant make run-auto-tag-assistant
```

Rules
```
make build-rules
ADDON_BASE_URL=https://abc123.ngrok-free.app/rules make run-rules
```

Tip: Print the manifest URL any time with:
```
make manifest-url
```

## 3) Install in Clockify
Go to Admin → Add-ons → “Install Custom Add-on” and provide the runtime manifest URL:

- Auto-Tag Assistant: `https://abc123.ngrok-free.app/auto-tag-assistant/manifest.json`
- Rules: `https://abc123.ngrok-free.app/rules/manifest.json`

The runtime manifest is generated by the SDK and has no `$schema` field.

## 4) Verify locally
```
curl $(ADDON_BASE_URL)/health
curl $(ADDON_BASE_URL)/manifest.json
```

## 5) Optional settings
- RULES_APPLY_CHANGES=true — apply Rules actions (add/remove tags, set billable/description); omit or set to false to log only.
- ADDON_FRAME_ANCESTORS='self' https://*.clockify.me — set CSP for the settings iframe.
- ADDON_RATE_LIMIT, ADDON_LIMIT_BY — enable RateLimiter.
- ADDON_CORS_ORIGINS, ADDON_CORS_ALLOW_CREDENTIALS — enable CORS allowlist.

