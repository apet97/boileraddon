# Staging profile (mirror production minus customer traffic)
# Reference: addons/rules/README.md#configuration-profiles

ENV=staging
ADDON_PORT=8080
ADDON_BASE_URL=https://staging-rules.example.com/rules
CLOCKIFY_API_BASE_URL=https://api.clockify.me/api

# Start in log-only mode. Flip to true after verifying webhook smoke tests.
RULES_APPLY_CHANGES=false
# TTL must remain between 60 seconds and 24 hours. Keep staging aligned with prod.
RULES_WEBHOOK_DEDUP_SECONDS=600

# JWT bootstrap (pick one source). JWKS is recommended to match production.
CLOCKIFY_JWT_JWKS_URI=https://clockify.example.com/.well-known/jwks.json
CLOCKIFY_JWT_EXPECT_ISS=clockify
CLOCKIFY_JWT_EXPECT_AUD=rules
# Alternate sources (leave commented unless used)
# CLOCKIFY_JWT_PUBLIC_KEY_MAP='{"kid-2024":"-----BEGIN PUBLIC KEY-----\n...\n"}'
# CLOCKIFY_JWT_PUBLIC_KEY="-----BEGIN PUBLIC KEY-----\n...\n-----END PUBLIC KEY-----"
# CLOCKIFY_JWT_DEFAULT_KID=kid-2024
# CLOCKIFY_JWT_LEEWAY_SECONDS=60

# Persistence â€” required in non-dev environments.
ENABLE_DB_TOKEN_STORE=true
DB_URL=jdbc:postgresql://staging-db:5432/clockify_addons
DB_USER=addons
DB_PASSWORD=replace-me
RULES_DB_URL=jdbc:postgresql://staging-db:5432/rules
RULES_DB_USERNAME=rules
RULES_DB_PASSWORD=replace-me

# Security / middleware (set to match ingress requirements)
ADDON_FRAME_ANCESTORS='self' https://app.clockify.me
# ADDON_RATE_LIMIT=10
# ADDON_LIMIT_BY=workspace
# ADDON_CORS_ORIGINS=https://app.clockify.me
# ADDON_CORS_ALLOW_CREDENTIALS=true

# Never set these outside dev.
# CLOCKIFY_WORKSPACE_ID=
# CLOCKIFY_INSTALLATION_TOKEN=
# ADDON_SKIP_SIGNATURE_VERIFY=true
# ADDON_ACCEPT_JWT_SIGNATURE=true
